<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ‹é¦¬å±å¤§å¸« - çµ‚æ¥µ Q å½ˆä¿®æ­£ç‰ˆ</title>
    <style>
        :root {
            --primary-red: #d32f2f;
            --gold: #ffd700;
            --butt-pink: #ffb6c1;
            /* --- èª¿æ•´é€™è£¡ä¾†ç§»å‹•å±å±çš„ä½ç½® --- */
            --butt-y-offset: 40px; /* è¶Šé«˜æ•¸å­—å±å±è¶Šå¾€ä¸Š */
            --butt-scale: 1.1;     /* èª¿æ•´å±å±çš„å¤§å° */
        }
        
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            background-color: #f5e6d3;
            font-family: "Microsoft JhengHei", sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            touch-action: manipulation;
        }

        /* é–€çš„å ´æ™¯ */
        .door-scene {
            position: relative;
            width: 380px;
            height: 620px;
            background-color: #5d2906;
            background-image: url('door.jpg'); 
            background-size: cover;
            background-position: center;
            border: 12px solid #2a1104;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 40px 80px rgba(0,0,0,0.8);
            transition: transform 0.1s;
        }

        /* é–€æ¿éœ‡å‹• */
        @keyframes door-hit {
            0% { transform: scale(1); }
            50% { transform: scale(0.98); }
            100% { transform: scale(1); }
        }
        .hit-active { animation: door-hit 0.1s ease-out; }

        .couplet {
            position: absolute;
            background: var(--primary-red);
            color: var(--gold);
            padding: 12px 6px;
            font-weight: bold;
            border: 2px solid var(--gold);
            font-size: 1.4rem;
            text-align: center;
            z-index: 20;
            white-space: nowrap;
            box-shadow: 2px 4px 8px rgba(0,0,0,0.3);
            pointer-events: none;
        }
        .top-scroll { top: -50px; width: 220px; }
        .left-side { left: -75px; top: 40px; writing-mode: vertical-rl; }
        .right-side { right: -75px; top: 40px; writing-mode: vertical-rl; }

        /* é¦¬å…’å¡ç‰‡ */
        .horse-card {
            margin-top: 60px;
            width: 330px;
            height: 450px;
            background-color: #d32f2f;
            background-image: url('horse.png'); 
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            border: 6px solid var(--gold);
            position: relative;
            display: flex;
            justify-content: center;
            overflow: hidden;
        }

        /* å…©ç‰‡å¼ã€Œèœœæ¡ƒã€å±å±å®¹å™¨ */
        .butt-container {
            position: absolute;
            bottom: var(--butt-y-offset);
            width: 240px;
            height: 160px;
            z-index: 15;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            cursor: pointer;
            transform: scale(var(--butt-scale));
            transform-origin: center bottom;
        }

        .cheek {
            width: 105px;
            height: 125px;
            background: radial-gradient(circle at 50% 30%, #ffc0cb 0%, #ff80ab 70%, #f06292 100%);
            box-shadow: 
                0 10px 25px rgba(0,0,0,0.4),
                inset 0 -10px 20px rgba(0,0,0,0.1),
                inset 0 10px 15px rgba(255,255,255,0.5);
            transition: transform 0.1s;
        }

        .cheek.left {
            border-radius: 65% 35% 40% 65%;
            transform: rotate(-5deg) translateX(4px);
        }

        .cheek.right {
            border-radius: 35% 65% 65% 40%;
            transform: rotate(5deg) translateX(-4px);
        }

        /* Q å½ˆæœå‡å‹•ç•«ï¼šå£“æ‰ã€å·¦å³æ“´å¼µã€å›å½ˆéœ‡ç›ª */
        @keyframes jelly-effect {
            0% { transform: scale(var(--butt-scale), var(--butt-scale)); }
            20% { transform: scale(calc(var(--butt-scale) * 1.4), calc(var(--butt-scale) * 0.7)); }
            40% { transform: scale(calc(var(--butt-scale) * 0.9), calc(var(--butt-scale) * 1.15)); }
            60% { transform: scale(calc(var(--butt-scale) * 1.05), calc(var(--butt-scale) * 0.95)); }
            100% { transform: scale(var(--butt-scale), var(--butt-scale)); }
        }

        .jelly-active {
            animation: jelly-effect 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        /* çµ±è¨ˆèˆ‡æŒ‰éˆ• */
        .stats-panel {
            margin-top: 25px;
            color: var(--gold);
            text-align: center;
            background: rgba(0,0,0,0.85);
            padding: 15px 30px;
            border-radius: 30px;
            border: 2px solid var(--gold);
            backdrop-filter: blur(8px);
            width: 320px;
        }
        #score-num { font-size: 3.5rem; font-weight: bold; display: block; color: #fff; text-shadow: 0 0 15px var(--gold); }

        .lotto-btn {
            margin-top: 10px;
            padding: 12px 24px;
            background: linear-gradient(to bottom, #ffd700, #ffa000);
            color: #8b0000;
            border: none;
            border-radius: 25px;
            font-weight: 900;
            font-size: 1.1rem;
            cursor: pointer;
            display: none;
            box-shadow: 0 4px 0 #b8860b;
        }

        /* æ¼‚æµ®æ–‡å­— */
        .float-text {
            position: absolute;
            font-weight: 900;
            font-size: 2.2rem;
            pointer-events: none;
            z-index: 100;
            animation: float-up 0.8s ease-out forwards;
        }
        @keyframes float-up {
            0% { transform: translateY(0) scale(0.5); opacity: 0; }
            20% { opacity: 1; }
            100% { transform: translateY(-150px) scale(1.6); opacity: 0; }
        }

        /* é»æ“Šè¡æ“Šæ³¢ */
        .shockwave {
            position: absolute;
            border: 4px solid rgba(255,255,255,0.5);
            border-radius: 50%;
            pointer-events: none;
            animation: wave 0.4s ease-out forwards;
        }
        @keyframes wave {
            0% { width: 0; height: 0; opacity: 1; }
            100% { width: 200px; height: 100px; opacity: 0; }
        }

        /* å½ˆçª—æ¨£å¼ */
        .modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 1000;
            display: none;
            justify-content: center; align-items: center;
            flex-direction: column; color: var(--gold);
            padding: 20px;
        }
        .ball-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin: 20px; }
        .ball {
            width: 50px; height: 50px; background: white; border-radius: 50%;
            color: #8b0000; display: flex; justify-content: center; align-items: center;
            font-size: 1.5rem; font-weight: bold;
        }
    </style>
</head>
<body>

    <div id="lottoModal" class="modal">
        <h2>ğŸ® å¤§å¸«æŒ‡é»ï¼å¹¸é‹æ˜ç‰Œ ğŸ®</h2>
        <div id="ballContainer" class="ball-container"></div>
        <button onclick="document.getElementById('lottoModal').style.display='none'" style="padding:10px 30px; font-weight:bold; cursor:pointer;">æ”¶ä¸‹å¥½é‹</button>
    </div>

    <div id="door" class="door-scene">
        <div class="couplet top-scroll">è¨˜å¾—æ‹å±å±</div>
        <div class="couplet left-side">æ‹å·¦é‚Šæœ‰ Money</div>
        <div class="couplet right-side">æ‹å³é‚Šå°± Lucky</div>

        <div class="horse-card">
            <div id="patTarget" class="butt-container">
                <div class="cheek left"></div>
                <div class="cheek right"></div>
            </div>
        </div>

        <div class="stats-panel">
            ç´¯ç©è²¡æ°£ <span id="score-num">0</span>
            <button id="lottoBtn" class="lotto-btn" onclick="showLotto()">é ˜å–å¹¸é‹è™Ÿç¢¼</button>
        </div>
    </div>

    <script>
        const target = document.getElementById('patTarget');
        const scoreDisplay = document.getElementById('score-num');
        const lottoBtn = document.getElementById('lottoBtn');
        const door = document.getElementById('door');
        let score = 0;

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playPatSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(180, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(40, audioCtx.currentTime + 0.1);
            g.gain.setValueAtTime(0.6, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            osc.connect(g); g.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + 0.1);
        }

        function onPat(e) {
            if (e.cancelable) e.preventDefault();
            playPatSound();
            
            const gain = Math.floor(Math.random() * 10) + 1;
            score += gain;
            scoreDisplay.innerText = score;

            if (score >= 200) lottoBtn.style.display = 'inline-block';

            // è§¸ç™¼ Q å½ˆå‹•ç•«
            target.classList.remove('jelly-active');
            void target.offsetWidth; 
            target.classList.add('jelly-active');

            // è§¸ç™¼é–€æ¿æ‰“æ“Šå‹•ç•«
            door.classList.remove('hit-active');
            void door.offsetWidth;
            door.classList.add('hit-active');

            // å»ºç«‹è¡æ“Šæ³¢ç‰¹æ•ˆ
            const x = e.clientX || (e.touches ? e.touches[0].clientX : 0);
            const y = e.clientY || (e.touches ? e.touches[0].clientY : 0);
            createShockwave(x, y);

            // å™´å‡ºæ–‡å­—
            const rect = target.getBoundingClientRect();
            const isLeft = (x - rect.left) < rect.width / 2;
            createFloat(x, y, isLeft ? `ğŸ’° +${gain}` : `ğŸ€ +${gain}`, isLeft ? "gold" : "#00ff88");

            if (navigator.vibrate) navigator.vibrate(40);
        }

        function createShockwave(x, y) {
            const wave = document.createElement('div');
            wave.className = 'shockwave';
            wave.style.left = (x - 100) + 'px';
            wave.style.top = (y - 50) + 'px';
            document.body.appendChild(wave);
            setTimeout(() => wave.remove(), 400);
        }

        function createFloat(x, y, txt, clr) {
            const div = document.createElement('div');
            div.className = 'float-text';
            div.innerText = txt;
            div.style.color = clr;
            div.style.left = (x - 40) + 'px';
            div.style.top = (y - 40) + 'px';
            div.style.textShadow = '0 0 10px ' + clr;
            document.body.appendChild(div);
            setTimeout(() => div.remove(), 800);
        }

        function showLotto() {
            const container = document.getElementById('ballContainer');
            container.innerHTML = '';
            for(let i=0; i<6; i++) {
                const b = document.createElement('div');
                b.className = 'ball';
                b.innerText = Math.floor(Math.random() * 49) + 1;
                container.appendChild(b);
            }
            document.getElementById('lottoModal').style.display = 'flex';
        }

        target.addEventListener('mousedown', onPat);
        target.addEventListener('touchstart', onPat, { passive: false });
    </script>
</body>
</html>
