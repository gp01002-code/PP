<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ‹é¦¬å±å¤§å¸« - å°å½©æ˜ç‰Œç‰ˆ</title>
    <style>
        :root {
            --primary-red: #d32f2f;
            --gold: #ffd700;
            --horse-brown: #b06d45;
            --horse-dark: #7b4a30;
            --wood-base: #5d2906;
            --wood-grain: #4a1f04;
        }
        
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            background-color: #f5e6d3;
            font-family: "Microsoft JhengHei", "PingFang TC", "Kaiti TC", sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
            touch-action: manipulation;
        }

        /* è±ªè¯æœ¨é–€èƒŒæ™¯ */
        .door-scene {
            position: relative;
            width: 400px;
            height: 650px;
            background: 
                repeating-linear-gradient(90deg, var(--wood-base) 0px, var(--wood-base) 40px, var(--wood-grain) 41px, var(--wood-base) 42px),
                linear-gradient(rgba(0,0,0,0.1), rgba(0,0,0,0.1));
            border: 15px solid #2a1104;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 40px 80px rgba(0,0,0,0.8);
            margin: 40px 0;
            overflow: visible;
        }

        .door-scene::after {
            content: '';
            position: absolute;
            left: 50%; top: 0; bottom: 0; width: 4px;
            background: rgba(0,0,0,0.5);
            transform: translateX(-50%);
        }

        /* æ˜¥è¯æ¨£å¼ */
        .couplet {
            position: absolute;
            background: var(--primary-red);
            color: var(--gold);
            padding: 15px 8px;
            font-weight: bold;
            border: 3px solid var(--gold);
            font-size: 1.6rem;
            text-align: center;
            box-shadow: 4px 6px 12px rgba(0,0,0,0.5);
            z-index: 20;
            white-space: nowrap;
        }

        @keyframes shake {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(3deg); }
            75% { transform: rotate(-3deg); }
            100% { transform: rotate(0deg); }
        }
        .shake-active { animation: shake 0.2s ease-in-out; }
        
        .top-scroll { top: -65px; width: 220px; writing-mode: horizontal-tb; }
        .left-side { left: -85px; top: 60px; writing-mode: vertical-rl; }
        .right-side { right: -85px; top: 60px; writing-mode: vertical-rl; }

        /* é¦¬å…’å¡ç‰‡ */
        .horse-card {
            margin-top: 80px;
            width: 340px;
            height: 460px;
            background: #d32f2f;
            border: 6px solid var(--gold);
            position: relative;
            display: flex;
            justify-content: center;
            overflow: hidden;
            z-index: 5;
        }

        .inner-text {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            color: #1a0505;
            font-size: 2.8rem;
            font-weight: 900;
            writing-mode: vertical-rl;
            z-index: 10;
            pointer-events: none;
            opacity: 0.8;
        }
        .text-left { left: 20px; }
        .text-right { right: 20px; }

        .horse-illustration {
            position: absolute;
            top: 50px;
            width: 300px;
            height: 300px;
            z-index: 5;
            pointer-events: none;
        }

        /* Qå½ˆå±å±å®¹å™¨ */
        .butt-container {
            position: absolute;
            bottom: 30px;
            width: 240px;
            height: 180px;
            z-index: 15;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .butt-model {
            width: 240px;
            height: 180px;
            background: radial-gradient(circle at 50% 30%, #ffc0cb 0%, #ff80ab 60%, #f06292 100%);
            border-radius: 50% 50% 45% 45%;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3), inset 0 15px 15px rgba(255,255,255,0.4);
            display: flex;
            justify-content: center;
            align-items: center;
            color: #880e4f;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            user-select: none;
            transform-origin: center bottom;
        }

        @keyframes jelly {
            0% { transform: scale(1, 1); }
            15% { transform: scale(1.5, 0.6); }
            40% { transform: scale(0.85, 1.15); }
            60% { transform: scale(1.1, 0.9); }
            100% { transform: scale(1, 1); }
        }
        .jelly-active { animation: jelly 0.5s ease; }

        /* çµ±è¨ˆé¢æ¿ */
        .stats-panel {
            margin-top: 30px;
            color: var(--gold);
            text-align: center;
            background: rgba(0,0,0,0.7);
            padding: 15px 30px;
            border-radius: 40px;
            border: 2px solid var(--gold);
            backdrop-filter: blur(8px);
        }
        
        #score-num {
            font-size: 3.5rem;
            font-weight: bold;
            display: block;
            color: #fff;
            text-shadow: 0 0 20px var(--gold);
        }

        /* å¹¸é‹é–‹è™ŸæŒ‰éˆ• */
        .lottery-btn {
            margin-top: 15px;
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            color: #8b0000;
            border: none;
            padding: 10px 20px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 20px;
            cursor: pointer;
            display: none; /* é”åˆ°è²¡æ°£æ‰é¡¯ç¤º */
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: transform 0.2s;
        }
        .lottery-btn:active { transform: scale(0.95); }

        /* è™Ÿç¢¼é¡¯ç¤ºå½ˆçª— */
        .lottery-modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: var(--gold);
            padding: 20px;
        }

        .ball-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
        }

        .lotto-ball {
            width: 60px;
            height: 60px;
            background: radial-gradient(circle at 30% 30%, #fff 0%, #ffd700 100%);
            border-radius: 50%;
            color: #8b0000;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.8rem;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(255,215,0,0.4);
            animation: bounceIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            opacity: 0;
        }

        @keyframes bounceIn {
            0% { transform: scale(0); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .disclaimer {
            font-size: 0.8rem;
            color: #aaa;
            max-width: 300px;
            text-align: center;
            margin-top: 20px;
            line-height: 1.4;
        }

        .close-btn {
            background: var(--primary-red);
            color: white;
            border: 2px solid var(--gold);
            padding: 10px 30px;
            margin-top: 20px;
            border-radius: 5px;
            cursor: pointer;
        }

        .float-particle {
            position: absolute;
            font-weight: 900;
            font-size: 2rem;
            pointer-events: none;
            z-index: 100;
            animation: particleAnim 0.7s forwards;
        }

        @keyframes particleAnim {
            0% { transform: translateY(0) scale(0.5); opacity: 0; }
            100% { transform: translateY(-180px) scale(1.5); opacity: 0; }
        }
    </style>
</head>
<body>

    <!-- å¹¸é‹è™Ÿç¢¼å½ˆçª— -->
    <div id="lotteryModal" class="lottery-modal">
        <h2 style="font-size: 2rem;">ğŸ® é¦¬åˆ°æˆåŠŸï¼å¹¸é‹æ¨è«– ğŸ®</h2>
        <p id="lottoType" style="color: #fff;">å¤§æ¨‚é€é æ¸¬è™Ÿç¢¼ï¼š</p>
        <div id="ballContainer" class="ball-container"></div>
        <p class="disclaimer">â€» è¨»ï¼šæ­¤è™Ÿç¢¼ç”±ã€Œé¦¬å±è²¡æ°£ã€çµåˆã€Œç•¶ä¸‹é‹å‹¢æ™‚åºã€æ¨è«–ç”¢ç”Ÿï¼Œåƒ…ä¾›å¨›æ¨‚åƒè€ƒï¼Œä¸ä¿è­‰ä¸­çã€‚è«‹ç†æ€§æŠ•æ³¨ã€‚</p>
        <button class="close-btn" onclick="closeLotto()">è¬å¤§å¸«é–‹æ˜ç‰Œ</button>
    </div>

    <div class="door-scene">
        <div id="topScroll" class="couplet top-scroll">è¨˜å¾—æ‹å±å±</div>
        <div id="leftCouplet" class="couplet left-side">æ‹å·¦é‚Šæœ‰ Money</div>
        <div id="rightCouplet" class="couplet right-side">æ‹å³é‚Šå°± Lucky</div>

        <div class="horse-card">
            <div class="inner-text text-left">æ‹é¦¬å±</div>
            <div class="inner-text text-right">èšè²¡æ°£</div>
            
            <svg class="horse-illustration" viewBox="0 0 200 200">
                <path d="M70 140 L130 140 L120 180 L80 180 Z" fill="var(--horse-brown)" />
                <path d="M70 140 Q100 130 130 140 L140 160 L60 160 Z" fill="var(--horse-brown)" />
                <path d="M55 100 Q45 90 55 80" fill="none" stroke="var(--horse-brown)" stroke-width="8" stroke-linecap="round" />
                <circle cx="52" cy="85" r="8" fill="white" />
                <path d="M145 100 Q155 90 145 80" fill="none" stroke="var(--horse-brown)" stroke-width="8" stroke-linecap="round" />
                <circle cx="148" cy="85" r="8" fill="white" />
                <g transform="translate(100, 80)">
                    <ellipse cx="0" cy="0" rx="45" ry="50" fill="var(--horse-brown)" />
                    <path d="M-20 -45 Q0 -65 20 -45 L0 -20 Z" fill="var(--horse-dark)" />
                    <ellipse cx="0" cy="20" rx="30" ry="20" fill="var(--horse-light)" />
                    <circle cx="-15" cy="-5" r="6" fill="white" /><circle cx="-13" cy="-3" r="3" fill="black" />
                    <circle cx="15" cy="-5" r="6" fill="white" /><circle cx="17" cy="-3" r="3" fill="black" />
                    <circle cx="-25" cy="15" r="8" fill="#ff4444" opacity="0.4" />
                    <circle cx="25" cy="15" r="8" fill="#ff4444" opacity="0.4" />
                    <path d="M-30 -35 L-45 -55 L-15 -45 Z" fill="var(--horse-brown)" />
                    <path d="M30 -35 L45 -55 L15 -45 Z" fill="var(--horse-brown)" />
                </g>
            </svg>
            
            <div class="butt-container">
                <div id="patTarget" class="butt-model">æ‹ï¼</div>
            </div>
        </div>

        <div class="stats-panel">
            ç´¯ç©è²¡æ°£
            <span id="score-num">0</span>
            <button id="lottoBtn" class="lottery-btn" onclick="revealLotto()">è§£é–‹å¹¸é‹è™Ÿç¢¼</button>
        </div>
    </div>

    <script>
        const target = document.getElementById('patTarget');
        const scoreDisplay = document.getElementById('score-num');
        const lottoBtn = document.getElementById('lottoBtn');
        const couplets = document.querySelectorAll('.couplet');
        
        let score = 0;
        const UNLOCK_SCORE = 500; // è¨­å®šç´¯ç©åˆ° 500 è§£é–

        // å‰ç¥¥è©±
        const auspiciousSayings = [
            ["è¨˜å¾—æ‹å±å±", "æ‹å·¦é‚Šæœ‰ Money", "æ‹å³é‚Šå°± Lucky"],
            ["å¤§ç™¼åˆ©å¸‚æ™‚", "å¥½é‹é€£é€£åˆ°", "å¯Œè²´å¹³å®‰å¹´"],
            ["é¦¬å±æ‹å¾—éŸ¿", "é»ƒé‡‘è¬å…©ä¾†", "é–‹çä¸­å¤§ç"]
        ];
        let currentSayingIndex = 0;
        setInterval(() => {
            currentSayingIndex = (currentSayingIndex + 1) % auspiciousSayings.length;
            document.getElementById('topScroll').innerText = auspiciousSayings[currentSayingIndex][0];
            document.getElementById('leftCouplet').innerText = auspiciousSayings[currentSayingIndex][1];
            document.getElementById('rightCouplet').innerText = auspiciousSayings[currentSayingIndex][2];
        }, 8000);

        function playSlapSound() {
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(240, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(80, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.1);
        }

        function onPat(e) {
            if (e.cancelable) e.preventDefault();
            playSlapSound();
            
            const gain = Math.floor(Math.random() * 10) + 1;
            score += gain;
            scoreDisplay.innerText = score;

            // æª¢æŸ¥æ˜¯å¦è§£é–æ˜ç‰ŒæŒ‰éˆ•
            if (score >= UNLOCK_SCORE) {
                lottoBtn.style.display = 'inline-block';
            }

            const rect = target.getBoundingClientRect();
            const x = e.clientX || (e.touches ? e.touches[0].clientX : 0);
            const y = e.clientY || (e.touches ? e.touches[0].clientY : 0);
            const isLeft = (x - rect.left) < rect.width / 2;
            
            target.classList.remove('jelly-active');
            void target.offsetWidth; 
            target.classList.add('jelly-active');
            
            couplets.forEach(c => {
                c.classList.remove('shake-active');
                void c.offsetWidth;
                c.classList.add('shake-active');
            });
            
            createParticle(x, y, isLeft ? `ğŸ’° +${gain}` : `ğŸ€ +${gain}`, isLeft ? "#FFD700" : "#00FF88");
        }

        function createParticle(x, y, text, color) {
            const el = document.createElement('div');
            el.className = 'float-particle';
            el.innerText = text;
            el.style.color = color;
            el.style.left = (x - 30) + 'px';
            el.style.top = (y - 30) + 'px';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 700);
        }

        /**
         * å¹¸é‹è™Ÿç¢¼æ¨è«–ç³»çµ±
         */
        function revealLotto() {
            const modal = document.getElementById('lotteryModal');
            const container = document.getElementById('ballContainer');
            container.innerHTML = '';
            modal.style.display = 'flex';

            // 1. æ¨è«–ç¨®å­ (è²¡æ°£å€¼ + ç•¶ä¸‹æ¯«ç§’)
            const seed = score + new Date().getMilliseconds();
            
            // 2. æ±ºå®šæŠ½å“ªä¸€ç¨® (æ©Ÿç‡å„åŠ)
            const isGrand = seed % 2 === 0; 
            document.getElementById('lottoType').innerText = isGrand ? "å¤§æ¨‚é€é æ¸¬è™Ÿç¢¼ (6/49)ï¼š" : "å¨åŠ›å½©é æ¸¬è™Ÿç¢¼ (6/38 + ç¬¬2å€)ï¼š";

            // 3. è™Ÿç¢¼æ¨è«–æ¼”ç®—æ³• (æ´—ç‰Œæ³•)
            const maxNum = isGrand ? 49 : 38;
            let numbers = [];
            while (numbers.length < 6) {
                // ä½¿ç”¨ seed å½±éŸ¿çš„å½éš¨æ©Ÿ
                const n = Math.floor(Math.abs(Math.sin(seed + numbers.length) * maxNum)) + 1;
                if (!numbers.includes(n)) numbers.push(n);
            }
            numbers.sort((a, b) => a - b);

            // 4. é€ä¸€é¡¯ç¤ºçƒé«”
            numbers.forEach((num, i) => {
                setTimeout(() => {
                    const ball = document.createElement('div');
                    ball.className = 'lotto-ball';
                    ball.innerText = num < 10 ? '0' + num : num;
                    container.appendChild(ball);
                }, i * 200);
            });

            // 5. å¦‚æœæ˜¯å¨åŠ›å½©ï¼ŒåŠ é–‹ç¬¬äºŒå€
            if (!isGrand) {
                setTimeout(() => {
                    const special = Math.floor(Math.abs(Math.cos(seed) * 8)) + 1;
                    const ball = document.createElement('div');
                    ball.className = 'lotto-ball';
                    ball.style.background = 'radial-gradient(circle at 30% 30%, #fff 0%, #ff4444 100%)';
                    ball.style.color = '#fff';
                    ball.innerText = special;
                    container.appendChild(ball);
                }, 1400);
            }
        }

        function closeLotto() {
            document.getElementById('lotteryModal').style.display = 'none';
        }

        target.addEventListener('mousedown', onPat);
        target.addEventListener('touchstart', onPat, { passive: false });
    </script>
</body>
</html>
